<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width" />

    <!-- Site Properities -->
    <title>This is cool! | Your Website</title>
    <meta name="description" content="When your website appears in search results in say Google, the text here will be shown underneath your website's title." />
    <meta name="keywords" content="place, your, website, keywoards, here, keep, them, related, to, the, content, of, your, website" />

    <!-- DocPad Meta -->
    <meta http-equiv="X-Powered-By" content="DocPad"/>

    <!-- DocPad Styles + Our Own -->
    <link  rel="stylesheet" href="/vendor/normalize.css" /><link  rel="stylesheet" href="/vendor/h5bp.css" /><link  rel="stylesheet" href="/styles/style.css" />

    <!-- Icons -->
    <!-- Favicon -->
    <link rel="shortcut icon" href="/icons/favicon.ico" />
    <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
    <link rel="apple-touch-icon-precomposed" href="icons/apple-touch-icon-57x57-precomposed.png" />
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="icons/apple-touch-icon-72x72-precomposed.png" />
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="icons/apple-touch-icon-114x114-precomposed.png" />
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="icons/apple-touch-icon-144x144-precomposed.png" />
</head>
<body>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
    <![endif]-->

    <header>
        <nav>
            
          <a href="/blog/Blog2.html">
              My Second blog post
          </a>
        
          <a href="/blog/blog1.html">
              My First Blog Post
          </a>
        
        </nav>
    </header>
    <article>
        <h1>oh hai</h1>
<h2>This is my about me page!</h2>
    </article>
    <footer></footer>

    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/vendor/jquery.js"><\/script>')</script>

    <!-- DocPad Scripts + Our Own -->
    <script defer="defer"  src="/vendor/log.js"></script><script defer="defer"  src="/vendor/modernizr.js"></script><script defer="defer"  src="/scripts/script.js"></script>
<style data-owner="saasy" type="text/css">#saasy {
    height:100%;
    width:205px;
    background:#efefef;
    position:fixed;
    left:0;
    top:0;
    padding:10px;
}
#saasy .form-holder > *  {
    display:block;
}
#saasy a {
    display:inline-block;
    margin-top:20px;
}
body {
    position:absolute;
    left:225px;
}
</style><div id='saasy' data-owner='saasy'>
    <div class='menu-holder'></div>
    <form id='ct-form'></form>
</div>
<script data-owner="saasy">var $S = { contentTypes:[{"name":"Blog Post","type":"blog","layout":"blog","fields":[{"Featured Image":"image"},{"Authored Date":"date"}]},{"name":"Case Study","type":"casestudy","layout":"casestudy","fields":[{"Hero Image":"image"},{"Project URL":"url"},{"Teaser Text":"textarea"},{"Pull Quote":"textarea"}]}], globalFields:{"filename":"text","content":"textarea","In menu?":"checkbox","title":"text"}};
/*globals $S, window, alert, console*/
/*jslint plusplus: true*/

$S.API = (function ($) {
    'use strict';
    if (typeof $ === 'undefined') {
        throw 'You can\'t use Saasy without jQuery';
    }

    var $menuSlot = $('#saasy .menu-holder');
    var $formSlot = $('#saasy #ct-form');

    function init () {
        var key,
            html = '';
        for (key in $S.contentTypes) {
            if ($S.contentTypes.hasOwnProperty(key)) {
                html += '<a href=\'javascript:$S.API.createForm($S.contentTypes[' + key + '])\'>' + $S.contentTypes[key].name + '</a>';
            }
        }
        $menuSlot.html(html);


        $formSlot.on( "submit", function( event ) {
          event.preventDefault();
          $S.API.create($(this).serialize());
        });

    }

    function buildForm(type, fileName) {
        var key,
            obj,
            innerKey,
            myId,
            myName,
            html = '';
        function buildInput(type, id, name) {
            switch (type) {
            case 'textarea':
                return '<textarea id="' + id + '" name="' + name + '"></textarea>';
            case 'image':
                return '<input id="' + id + '" name="' + name + '" type="file">';
            default:
                return '<input id="' + id + '" name="' + name + '" type="' + type + '">';
            }
        }

        function loadData() {
            $.ajax({
                url: '/saasy/document/' + fileName
            }).done(function (result) {
                var key;

                // TODO: Eventually this data needs to be read from a merge of the global fields
                // and the content type fields as they are the canonical source. 
                result.meta.content = result.content;
                
                for (key in result.meta) {
                    if (result.meta.hasOwnProperty(key)) {
                        $('#saasy-form-' + key).attr('value', result.meta[key]);
                    }
                }
            });
        }

        for (key in $S.globalFields) {
            if ($S.globalFields.hasOwnProperty(key)) {
                obj = $S.globalFields[key];
                myId = 'saasy-form-' + key;
                html += '<label for="' + myId + '">' + key + '</label>' + buildInput($S.globalFields[key], myId, key);
            }
        }

        for (key in type.fields) {
            if (type.fields.hasOwnProperty(key)) {
                obj = type.fields[key];
                innerKey = Object.keys(obj)[0];
                myId = 'saasy-form-' + innerKey;
                html += '<label for="' + myId + '">' + innerKey + '</label>' + buildInput(type.fields[key][innerKey], myId, innerKey);
            }
        }

        if (fileName) {
            loadData();
        }
        html += '<label for="saasy-form-layout">Layout</label><input id="saasy-form-layout" type="text" name="layout" value="' + type.layout + '">';
        html += '<input type="hidden" name="type" value="' + type.type + '">';
        html += '<input type="submit" value="Submit">';
        
        return html;
    }

    init();

    return {
        createForm: function (type) {
            $formSlot.html(buildForm(type));
        },
        editForm: function (type, fileName) {
            $formSlot.html(buildForm(type, fileName));
        },
        create: function(data) {
            $.ajax({
                url: '/saasy/',
                type: 'POST',
                data: data
            }).done(function (result) {
                console.log(result);
            });
        },
        delete: function () {
        },
        rename: function () {
        },
        curate: function () {
        }
    };
}(window.$));
</script></body>
</html>
